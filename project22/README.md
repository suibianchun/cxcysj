**Project22: research report on MPT**

**概述**

Merkle Patricia Tree是由Ralph C. Merkle和Patrick A. Duffin于1979年提出的一种哈希树结构，常用于快速验证和检索大量数据。MPT的设计旨在克服传统哈希树在存储和检索效率方面的一些限制。MPT在区块链技术中广泛应用，特别是以太坊等智能合约平台。

**作用**

存储任意长度的key-value键值对数据，符合以太坊的state模型；

提供了一种快速计算所维护数据集哈希标识的机制；

提供了快速状态回滚的机制；

提供了一种称为默克尔证明的证明方法，进行轻节点的扩展，实现简单支付验证；

**MPT的原理与结构**

MPT是一种基于前缀树（Trie）和默克尔树（Merkle Tree）的数据结构。它将键值对存储在树的叶子节点中，并使用键的前缀作为节点的索引。MPT通过哈希函数对节点进行哈希运算，确保树的完整性和安全性。MPT的主要特点是在保持数据完整性的同时，有效地支持数据的插入、删除和检索操作。

下面分别介绍一下前缀树（Trie）和默克尔树（Merkle Tree）

**前缀树（Trie）**

前缀树是一种用于高效存储和检索字符串的树形数据结构。它的设计基于字符串的共同前缀，将字符串按照字符逐级存储，从而实现快速的字符串匹配和搜索操作。

前缀树的主要特点是节点的关键字（字符）按照路径从根节点到叶子节点形成字符串的前缀。每个节点可以有多个子节点，每个子节点代表不同的字符。这种结构使得前缀树非常适合存储和搜索具有相同前缀的字符串集合。

![image](https://github.com/suibianchun/cxcysj/assets/138552183/498da4f8-0099-4326-a36c-39ae9ee9afb8)

上图是一棵Trie树，表示了关键字集合{“a”, “to”, “tea”, “ted”, “ten”, “i”, “in”, “inn”} 。

**默克尔树（Merkle Tree）**

默克尔树的主要特点是通过对数据进行哈希运算构建树结构。它将一组数据分成固定大小的块（通常为2的幂次），每个块通过哈希函数生成一个唯一的哈希值。然后，这些哈希值再逐级合并和哈希，直到最终形成一个根哈希值，称为根哈希（Root Hash）。

在默克尔树中，叶子节点存储着原始数据的哈希值，而非叶子节点存储着它的子节点的哈希值。每个非叶子节点的哈希值是由其子节点的哈希值计算得出的。这样的结构可以有效地检测数据的完整性。

通过根哈希，可以验证整个数据集的完整性。如果数据集中的任何一个块发生变化，将会导致根哈希的不同。因此，通过比较根哈希值，可以快速检测到数据是否被篡改或损坏。

下图是Merkle Tree的一个例子结构：
![image](https://github.com/suibianchun/cxcysj/assets/138552183/3683fe1d-dd29-4e8d-adce-0021e8d1ad0a)

